import React, {Fragment} from "react";
import {Marker} from "react-leaflet";
import AmbulancePopupContainer from "../AmbulancePopup/AmbulancePopupContainer";

const FAPLayer = (props) => {

    const {obj,tile} = props;

    const isDark = tile.includes('dark');
    const color= isDark? '#ddd' : '#000';

    const iconSVG = `
 <svg width="15" height="15" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path
            d="M8.45496 3.88825V3.5735H8.86621V3.3745C8.86621 3.0205 9.17546 2.73425 9.55821 2.73425C9.94021 2.73425 10.2495 3.0205 10.2495 3.3745V3.5735H10.6517V3.88825H8.45496Z"
            fill="black"/>
        <path
            d="M13.5495 11.8451C13.5495 12.2344 13.3948 12.6078 13.1195 12.8832C12.8441 13.1585 12.4707 13.3132 12.0813 13.3132C11.692 13.3132 11.3185 13.1585 11.0432 12.8832C10.7679 12.6078 10.6132 12.2344 10.6132 11.8451C10.6132 11.4557 10.7679 11.0823 11.0432 10.8069C11.3185 10.5316 11.692 10.3769 12.0813 10.3769C12.4707 10.3769 12.8441 10.5316 13.1195 10.8069C13.3948 11.0823 13.5495 11.4557 13.5495 11.8451V11.8451ZM12.7837 11.8451C12.7837 11.6588 12.7097 11.4803 12.5781 11.3486C12.4464 11.2169 12.2678 11.1429 12.0816 11.1429C11.8954 11.1429 11.7168 11.2169 11.5851 11.3486C11.4534 11.4803 11.3795 11.6588 11.3795 11.8451C11.3777 11.9384 11.3946 12.0311 11.4291 12.1178C11.4636 12.2046 11.515 12.2835 11.5804 12.3502C11.6457 12.4168 11.7237 12.4697 11.8098 12.5058C11.8959 12.5419 11.9883 12.5606 12.0816 12.5606C12.1749 12.5606 12.2673 12.5419 12.3534 12.5058C12.4394 12.4697 12.5174 12.4168 12.5828 12.3502C12.6482 12.2835 12.6996 12.2046 12.7341 12.1178C12.7686 12.0311 12.7855 11.9384 12.7837 11.8451V11.8451ZM5.14221 11.8311C5.14221 12.0239 5.10422 12.2149 5.0304 12.393C4.95658 12.5712 4.84839 12.7331 4.712 12.8694C4.5756 13.0058 4.41369 13.1139 4.23549 13.1877C4.0573 13.2614 3.86632 13.2994 3.67346 13.2993C3.28869 13.2922 2.92206 13.1344 2.65246 12.8597C2.38286 12.5851 2.23181 12.2156 2.23181 11.8308C2.23181 11.446 2.38286 11.0765 2.65246 10.8019C2.92206 10.5272 3.28869 10.3694 3.67346 10.3623C4.06296 10.3624 4.43646 10.5172 4.71188 10.7926C4.9873 11.0681 5.14208 11.4416 5.14221 11.8311V11.8311ZM4.37896 11.8323C4.37896 11.4443 4.06446 11.1303 3.67646 11.1303C3.5375 11.1303 3.40166 11.1715 3.28612 11.2487C3.17059 11.3259 3.08055 11.4357 3.02739 11.5641C2.97423 11.6925 2.96035 11.8338 2.9875 11.97C3.01465 12.1063 3.0816 12.2315 3.1799 12.3297C3.27819 12.4279 3.40341 12.4948 3.53972 12.5219C3.67602 12.5489 3.81729 12.5349 3.94565 12.4817C4.074 12.4284 4.18368 12.3383 4.26081 12.2227C4.33795 12.1071 4.37906 11.9713 4.37896 11.8323Z"
            fill="black"/>
        <path
            d="M14.547 7.66881C14.9858 7.75431 15.2483 7.94356 15.4463 9.02631L15.7595 10.9801C15.8723 11.6158 15.513 11.8478 15.065 11.8478H13.989C13.989 10.7943 13.1355 9.93731 12.082 9.93731C11.0285 9.93731 10.174 10.7943 10.174 11.8478H5.5758C5.5758 10.7943 4.7218 9.93731 3.6683 9.93731C2.6143 9.93731 1.76055 10.7943 1.76055 11.8478H0.869047C0.555047 11.8478 0.310547 11.6101 0.310547 11.3033V4.87881C0.310547 4.52881 0.586797 4.24756 0.925547 4.24756H12.47C12.9088 4.24756 13.2295 4.46531 13.388 4.84706L14.547 7.66906V7.66881ZM10.6988 4.90231V7.57106H13.7845L12.702 4.90231H10.6985H10.6988ZM7.9383 7.22856V5.59106H6.3008V7.22856H4.66305V8.86631H6.3008V10.5036H7.9383V8.86631H9.5758V7.22856H7.9383V7.22856Z"
            fill="black"/>
    </svg>
    `;

    const divIcon = L.divIcon(
        {
            className: "trashIcon",
            html: iconSVG
        }
    );

    let Elements;
    let iteratedList = obj.ambulance
    if (obj.filtered && iteratedList) {
        let newList  = [];
        for (let it = 0; it<obj.filtered.length;it++){
            const cityToList = iteratedList.find(el=> el.id===obj.filtered[it].id);
            newList.push(cityToList)
        }
        iteratedList = newList;
    }
    if (iteratedList) {
        Elements = iteratedList.map(objectIterator => {
            const pointsStr = objectIterator.point;
            if (pointsStr) {
                const pointsStrArr = pointsStr.replace('POINT (', '').replace(')', '').replace('POINT(', '');
                const pointStr = pointsStrArr.trim().split(' ');
                const point1 = Number.parseFloat(pointStr[1]).toFixed(6);
                const point2 = Number.parseFloat(pointStr[0]).toFixed(6);
                const points = [point1, point2];
                if (point1 && point2 && points) {
                    return (
                    <Marker position={points}
                            key={'ambulance'+objectIterator.id} icon={divIcon}
                            onContextMenu={(event) => {
                    }}>
                       <AmbulancePopupContainer obj={objectIterator}/>
                    </Marker>
                    )
                } else debugger
            }
        });
    }
    return (
        <Fragment>
            {Elements}
        </Fragment>
    )
};

export default FAPLayer;
